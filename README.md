# ğŸš€ WaHub - API de WhatsApp con WebHooks

[![.NET](https://img.shields.io/badge/.NET-9.0-512BD4?logo=dotnet)](https://dotnet.microsoft.com/)
[![Blazor](https://img.shields.io/badge/Blazor-Server-512BD4?logo=blazor)](https://dotnet.microsoft.com/apps/aspnet/web-apps/blazor)
[![API](https://img.shields.io/badge/API-WhatsApp-25D366?logo=whatsapp)](https://developers.facebook.com/docs/whatsapp/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## ğŸ“‹ DescripciÃ³n
WaHub es la soluciÃ³n todo-en-uno para PYMEs que buscan potenciar su comunicaciÃ³n empresarial a travÃ©s de WhatsApp. Nuestra plataforma ofrece una API RESTful robusta y una interfaz intuitiva que permite a las empresas enviar mensajes masivos, programar campaÃ±as y gestionar conversaciones de manera eficiente.

Desarrollada con .NET 9.0 y Blazor Server, WaHub estÃ¡ diseÃ±ada para escalar con tu negocio, ofreciendo herramientas profesionales de marketing y atenciÃ³n al cliente a travÃ©s de la plataforma de mensajerÃ­a mÃ¡s popular del mundo.

### ğŸ† Por quÃ© WaHub para tu PYME
- **Ahorro de tiempo**: Automatiza tus comunicaciones y campaÃ±as
- **Mayor alcance**: Llega a miles de clientes con unos pocos clics
- **MÃ©tricas en tiempo real**: Toma decisiones basadas en datos
- **Cumplimiento garantizado**: Cumple con las polÃ­ticas de WhatsApp Business
- **Soporte dedicado**: Equipo experto para ayudarte a sacar el mÃ¡ximo provecho

## âœ¨ CaracterÃ­sticas Principales

### ğŸ’¬ API de WhatsApp
- EnvÃ­o y recepciÃ³n de mensajes de texto, imÃ¡genes, documentos y mÃ¡s
- GestiÃ³n de contactos y listas de difusiÃ³n
- Plantillas de mensajes preaprobadas
- Soporte para respuestas rÃ¡pidas y botones de acciÃ³n

### ğŸ“¢ MensajerÃ­a Masiva para PYMEs
- **EnvÃ­o masivo** de mensajes a mÃºltiples contactos
- **SegmentaciÃ³n avanzada** de audiencias
- **PersonalizaciÃ³n** de mensajes con variables
- **LÃ­mites controlados** para cumplir con polÃ­ticas de WhatsApp
- **Informes detallados** de entregas y lecturas

### ğŸ“… CampaÃ±as Programadas
- **ProgramaciÃ³n flexible** de envÃ­os
- **Calendario de campaÃ±as** visual
- **Plantillas reutilizables** para campaÃ±as recurrentes
- **OptimizaciÃ³n** de horarios de envÃ­o
- **A/B testing** de mensajes
- **AnÃ¡lisis de rendimiento** por campaÃ±a

### ğŸ”„ WebHooks en Tiempo Real
- ConfiguraciÃ³n personalizada de WebHooks
- Notificaciones instantÃ¡neas de mensajes entrantes
- Estados de entrega y lectura de mensajes
- Eventos de conexiÃ³n del dispositivo
- Seguimiento de interacciones por campaÃ±a

### ğŸ” AutenticaciÃ³n y Seguridad
- AutenticaciÃ³n mediante API Keys y JWT
- GestiÃ³n de sesiones seguras
- Rate limiting configurable
- Registro detallado de actividades

### ğŸ“Š Panel de Control para PYMEs
- **VisiÃ³n general** del rendimiento de campaÃ±as
- **MÃ©tricas clave** (tasa de apertura, clics, respuestas)
- **GrÃ¡ficos comparativos** entre campaÃ±as
- **ExportaciÃ³n de informes** en mÃºltiples formatos
- **Alertas personalizables** para mÃ©tricas importantes

### ğŸ¢ Soluciones por Industria

### ğŸ›ï¸ Comercio Minorista
- Notificaciones de pedidos y envÃ­os
- CampaÃ±as de descuentos personalizadas
- Encuestas de satisfacciÃ³n post-compra

### ğŸ¥ Salud y Bienestar
- Recordatorios de citas
- Seguimiento de tratamientos
- Encuestas de satisfacciÃ³n

### ğŸ¢ Servicios Profesionales
- ConfirmaciÃ³n de citas
- Recordatorios de pagos
- Encuestas de satisfacciÃ³n

### ğŸ“ EducaciÃ³n
- Notificaciones a padres y estudiantes
- Recordatorios de clases y eventos
- Encuestas de satisfacciÃ³n

## ğŸ“š DocumentaciÃ³n Completa
- DocumentaciÃ³n interactiva con Swagger/OpenAPI
- Ejemplos de cÃ³digo en mÃºltiples lenguajes
- GuÃ­as de integraciÃ³n paso a paso
- SDKs oficiales disponibles
- Casos de Ã©xito de PYMEs
- Webinars y tutoriales en video

## ğŸ› ï¸ TecnologÃ­as Utilizadas

### Backend
- .NET 9.0
- ASP.NET Core Web API
- Entity Framework Core
- SignalR para notificaciones en tiempo real
- FluentValidation para validaciÃ³n de datos
- AutoMapper para mapeo de objetos

### WhatsApp Integration
- WhatsApp Business API Client
- WebSockets para comunicaciÃ³n en tiempo real
- Sistema de colas para manejo de mensajes
- Plantillas de mensajes aprobadas por WhatsApp

### Almacenamiento
- SQL Server para datos estructurados
- Azure Blob Storage para archivos multimedia
- Redis para cachÃ© y colas

### Seguridad
- JWT para autenticaciÃ³n de API
- Rate limiting
- EncriptaciÃ³n de extremo a extremo
- ValidaciÃ³n de firmas WebHook

### Herramientas de Desarrollo
- Visual Studio 2022
- Postman para pruebas de API
- Git para control de versiones
- Docker para contenedorizaciÃ³n

## ğŸš€ Requisitos Previos

### Desarrollo
- [.NET 9.0 SDK](https://dotnet.microsoft.com/download/dotnet/9.0)
- [Visual Studio 2022](https://visualstudio.microsoft.com/es/vs/) o [VS Code](https://code.visualstudio.com/)
- [SQL Server 2019+](https://www.microsoft.com/es-es/sql-server/sql-server-downloads) o [SQL Server Express](https://www.microsoft.com/es-es/sql-server/sql-server-downloads)
- [Git](https://git-scm.com/)
- [Docker Desktop](https://www.docker.com/products/docker-desktop/) (opcional, para ejecutar dependencias)
- Cuenta de desarrollador de [WhatsApp Business API](https://developers.facebook.com/docs/whatsapp/cloud-api/)

### ProducciÃ³n
- **Servidor**: Windows Server 2019/2022 o Linux
- **Runtime**: .NET 9.0 Runtime
- **Base de datos**: SQL Server 2019+ o Azure SQL Database
- **Almacenamiento**: Azure Blob Storage o AWS S3 para archivos multimedia
- **CachÃ©**: Redis Server
- **Web Server**: Kestrel detrÃ¡s de Nginx/Apache/IIS
- **SSL/TLS**: Certificado SSL vÃ¡lido (Let's Encrypt o comercial)
- **Dominio**: Dominio registrado con registros DNS configurados
- **IP PÃºblica**: DirecciÃ³n IP estÃ¡tica para el servidor

## ğŸ› ï¸ InstalaciÃ³n

### 1. Clonar el Repositorio
```bash
git clone https://github.com/tu-usuario/wahub.git
cd wahub
```

### 2. ConfiguraciÃ³n Inicial
1. Copia el archivo de configuraciÃ³n de ejemplo y ajusta los valores:
   ```bash
   cd src/WaHub.Blazor
   copy appsettings.Example.json appsettings.Development.json
   ```

2. Configura las variables de entorno necesarias:
   ```bash
   # ConfiguraciÃ³n de WhatsApp
   set WHATSAPP_API_KEY=tu_api_key
   set WHATSAPP_API_SECRET=tu_api_secret
   
   # ConfiguraciÃ³n de base de datos
   set CONNECTION_STRINGS__DEFAULT=Server=localhost;Database=WaHub;Trusted_Connection=True;TrustServerCertificate=True;
   ```

### 3. ConfiguraciÃ³n de WhatsApp
1. Crea una aplicaciÃ³n en el [Panel de Desarrolladores de WhatsApp](https://developers.facebook.com/)
2. ObtÃ©n tus credenciales (API Key y API Secret)
3. Configura los WebHooks en el panel de desarrolladores

### 4. Base de Datos
```bash
# Instalar herramientas de EF Core
dotnet tool install --global dotnet-ef

# Aplicar migraciones
dotnet ef database update --project src/WaHub.Blazor

# O usar migraciones automÃ¡ticas (solo desarrollo)
dotnet run --project src/WaHub.Blazor -- --migrate
```

### 5. Ejecutar la AplicaciÃ³n

**OpciÃ³n 1: Desarrollo con Hot Reload**
```bash
dotnet watch --project src/WaHub.Blazor
```

**OpciÃ³n 2: Docker (recomendado para producciÃ³n)**
```bash
docker-compose -f docker-compose.yml up -d
```

**OpciÃ³n 3: Visual Studio 2022**
1. Abre `WaHub.sln`
2. Establece `WaHub.Blazor` como proyecto de inicio
3. Presiona F5 o el botÃ³n de Iniciar depuraciÃ³n

### 6. Verificar la instalaciÃ³n
Accede a la documentaciÃ³n de la API en:
```
https://localhost:5001/swagger
```

Verifica el estado del servicio en:
```
https://localhost:5001/health
```

## ğŸ—ï¸ Estructura del Proyecto

```
WaHub/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ WaHub.API/                  # API Principal
â”‚   â”‚   â”œâ”€â”€ Controllers/            # Controladores de la API
â”‚   â”‚   â”œâ”€â”€ Middleware/             # Middleware personalizado
â”‚   â”‚   â”œâ”€â”€ Models/                 # Modelos de solicitud/respuesta
â”‚   â”‚   â”œâ”€â”€ Services/               # LÃ³gica de negocio
â”‚   â”‚   â”‚   â”œâ”€â”€ WhatsApp/           # Servicios especÃ­ficos de WhatsApp
â”‚   â”‚   â”‚   â””â”€â”€ WebHooks/           # Manejo de WebHooks
â”‚   â”‚   â”œâ”€â”€ appsettings.json        # ConfiguraciÃ³n
â”‚   â”‚   â””â”€â”€ Program.cs              # ConfiguraciÃ³n de la aplicaciÃ³n
â”‚   â”‚
â”‚   â”œâ”€â”€ WaHub.Core/                # NÃºcleo de la aplicaciÃ³n
â”‚   â”‚   â”œâ”€â”€ Entities/               # Entidades del dominio
â”‚   â”‚   â”œâ”€â”€ Interfaces/             # Interfaces del dominio
â”‚   â”‚   â”œâ”€â”€ DTOs/                   # Objetos de transferencia de datos
â”‚   â”‚   â””â”€â”€ Exceptions/             # Excepciones personalizadas
â”‚   â”‚
â”‚   â””â”€â”€ WaHub.Infrastructure/      # Infraestructura
â”‚       â”œâ”€â”€ Data/                   # Contexto de EF Core
â”‚       â”œâ”€â”€ Repositories/           # Implementaciones de repositorios
â”‚       â”œâ”€â”€ Services/               # Servicios de infraestructura
â”‚       â””â”€â”€ Extensions/             # MÃ©todos de extensiÃ³n
â”‚
â”œâ”€â”€ tests/                         # Pruebas
â”‚   â”œâ”€â”€ WaHub.API.Tests/           # Pruebas de la API
â”‚   â””â”€â”€ WaHub.Core.Tests/          # Pruebas unitarias
â”‚
â”œâ”€â”€ docs/                          # DocumentaciÃ³n
â”‚   â”œâ”€â”€ api/                       # DocumentaciÃ³n de la API
â”‚   â””â”€â”€ guides/                    # GuÃ­as de usuario
â”‚
â”œâ”€â”€ docker/                       # ConfiguraciÃ³n de Docker
â”œâ”€â”€ scripts/                       # Scripts de utilidad
â””â”€â”€ WaHub.sln                     # SoluciÃ³n de Visual Studio
```

## ğŸš€ Despliegue en ProducciÃ³n

### Requisitos MÃ­nimos
- **Servidor**: 2+ vCPUs, 4GB+ RAM, 50GB+ almacenamiento SSD
- **Sistema Operativo**: Ubuntu 22.04 LTS o Windows Server 2022
- **Red**: IP PÃºblica, puertos 80/443 abiertos, ancho de banda mÃ­nimo 10Mbps

### Pasos para Despliegue

1. **Preparar el Entorno**
   ```bash
   # Actualizar sistema
   sudo apt update && sudo apt upgrade -y
   
   # Instalar dependencias
   sudo apt install -y nginx certbot python3-certbot-nginx
   
   # Instalar .NET 9.0 Runtime
   wget https://packages.microsoft.com/config/ubuntu/22.04/packages-microsoft-prod.deb -O packages-microsoft-prod.deb
   sudo dpkg -i packages-microsoft-prod.deb
   rm packages-microsoft-prod.deb
   sudo apt update
   sudo apt install -y aspnetcore-runtime-9.0
   ```

2. **Configurar Base de Datos**
   - Instalar SQL Server o configurar conexiÃ³n a Azure SQL
   - Ejecutar migraciones: `dotnet ef database update`

3. **Configurar Nginx como Proxy Inverso**
   ```nginx
   server {
       listen 80;
       server_name tu-dominio.com;
       return 301 https://$host$request_uri;
   }

   server {
       listen 443 ssl;
       server_name tu-dominio.com;

       ssl_certificate /etc/letsencrypt/live/tu-dominio.com/fullchain.pem;
       ssl_certificate_key /etc/letsencrypt/live/tu-dominio.com/privkey.pem;

       location / {
           proxy_pass http://localhost:5000;
           proxy_http_version 1.1;
           proxy_set_header Upgrade $http_upgrade;
           proxy_set_header Connection keep-alive;
           proxy_set_header Host $host;
           proxy_cache_bypass $http_upgrade;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
       }
   }
   ```

4. **Obtener Certificado SSL**
   ```bash
   sudo certbot --nginx -d tu-dominio.com
   ```

5. **Configurar Servicio de Sistema**
   ```bash
   sudo nano /etc/systemd/system/wahub.service
   ```
   
   ```ini
   [Unit]
   Description=WaHub WhatsApp API
   After=network.target

   [Service]
   WorkingDirectory=/var/www/wahub
   ExecStart=/usr/bin/dotnet /var/www/wahub/WaHub.API.dll
   Restart=always
   RestartSec=10
   SyslogIdentifier=wahub
   User=www-data
   Environment=ASPNETCORE_ENVIRONMENT=Production
   Environment=DOTNET_PRINT_TELEMETRY_MESSAGE=false
   Environment=ASPNETCORE_URLS=http://localhost:5000

   [Install]
   WantedBy=multi-user.target
   ```

6. **Iniciar el Servicio**
   ```bash
   sudo systemctl enable wahub.service
   sudo systemctl start wahub.service
   sudo systemctl status wahub.service
   ```

## ğŸ§ª Ejecutando Pruebas

### Pruebas Unitarias
```bash
# Ejecutar todas las pruebas
dotnet test

# Ejecutar pruebas especÃ­ficas
dotnet test --filter "FullyQualifiedName~WhatsAppServiceTests"

# Generar cobertura de cÃ³digo
dotnet test /p:CollectCoverage=true /p:CoverletOutputFormat=opencover
```

### Pruebas de IntegraciÃ³n
1. Configurar entorno de pruebas en `appsettings.Testing.json`
2. Ejecutar contenedores de prueba:
   ```bash
   docker-compose -f docker-compose.test.yml up -d
   ```
3. Ejecutar pruebas de integraciÃ³n:
   ```bash
   dotnet test WaHub.IntegrationTests
   ```

### Pruebas de Carga
```bash
# Instalar k6
sudo apt-get update && sudo apt-get install -y k6

# Ejecutar prueba de carga
k6 run tests/load/send-message-test.js
```

### Monitoreo
La API incluye endpoints de salud y mÃ©tricas:
- `GET /health`: Estado general del servicio
- `GET /metrics`: MÃ©tricas en formato Prometheus
- `GET /swagger`: DocumentaciÃ³n interactiva de la API

## ğŸ¤ ContribuciÃ³n
Â¡Las contribuciones son bienvenidas! Por favor, lee nuestras [pautas de contribuciÃ³n](CONTRIBUTING.md) antes de enviar un pull request.

1. Haz un Fork del proyecto
2. Crea una rama para tu feature (`git checkout -b feature/AmazingFeature`)
3. Haz commit de tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. Haz push a la rama (`git push origin feature/AmazingFeature`)
5. Abre un Pull Request

## ğŸ“„ Licencia
Distribuido bajo la licencia MIT. Consulta el archivo `LICENSE` para mÃ¡s informaciÃ³n.

## ğŸ“ Contacto
Equipo de Desarrollo WaHub - [@WaHubApp](https://twitter.com/WaHubApp) - info@wahub.app

Enlace del Proyecto: [https://github.com/tu-usuario/wahub](https://github.com/tu-usuario/wahub)

## ğŸ™ Agradecimientos
- [.NET Foundation](https://dotnetfoundation.org/)
- [Blazor](https://dotnet.microsoft.com/apps/aspnet/web-apps/blazor)
- [Bootstrap](https://getbootstrap.com/)
- Y a todos los contribuidores que han ayudado a hacer de WaHub una realidad.

## ğŸ—„ï¸ Migraciones AutomÃ¡ticas

WaHub incluye un sistema robusto de migraciones automÃ¡ticas que se ejecuta en producciÃ³n para mantener la base de datos actualizada sin intervenciÃ³n manual.

### âœ¨ CaracterÃ­sticas

- âœ… **AutomÃ¡tico en ProducciÃ³n**: Se ejecuta automÃ¡ticamente al iniciar la aplicaciÃ³n
- âœ… **Seguro para Desarrollo**: Deshabilitado en entorno Development
- âœ… **Logs Detallados**: Registra todo el proceso de migraciÃ³n
- âœ… **Manejo de Errores**: ContinÃºa la ejecuciÃ³n incluso si las migraciones fallan (configurable)
- âœ… **ValidaciÃ³n de Conectividad**: Verifica la conexiÃ³n antes de ejecutar migraciones

### ğŸ› ï¸ ConfiguraciÃ³n

**Configurar migraciones automÃ¡ticas:**
```json
{
  "Database": {
    "AutoMigrate": true,
    "FailOnMigrationError": false
  }
}
```

**Variables de entorno para Docker:**
```bash
Database__AutoMigrate=true
Database__FailOnMigrationError=false
```

### ğŸ“‹ Comandos de MigraciÃ³n

```bash
# Crear nueva migraciÃ³n
dotnet ef migrations add NombreMigration --project src/WaHub

# Ver migraciones disponibles
dotnet ef migrations list --project src/WaHub

# Aplicar migraciones manualmente
dotnet ef database update --project src/WaHub

# Probar migraciones localmente
.\deploy.ps1 test-migration
```

Para mÃ¡s informaciÃ³n detallada, consulta [MIGRATIONS-CONFIG.md](MIGRATIONS-CONFIG.md).

---

<div align="center">
  <sub>Hecho con â¤ï¸ por el equipo de WaHub</sub>
</div>

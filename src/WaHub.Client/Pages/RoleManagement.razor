@page "/admin/roles"
@attribute [Authorize(Roles = "Admin")]
@inject IApiAdminService ApiAdminService
@inject NavigationManager NavigationManager
@inject NotificationService NotificationService


<h3>Administraci√≥n de Roles y Usuarios</h3>

@if (isLoading)
{
    <p><em>Cargando...</em></p>
}
else
{
    <div class="row">
        <div class="col-md-4">
            <h4>Roles</h4>
            <div class="input-group mb-3">
                <input @bind="newRoleName" class="form-control" placeholder="Nuevo nombre de rol" />
                <button class="btn btn-primary" @onclick="CreateRole">Crear Rol</button>
            </div>
            <ul class="list-group">
                @foreach (var role in roles)
                {
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        @role
                        <button class="btn btn-danger btn-sm" @onclick="() => DeleteRole(role)">Eliminar</button>
                    </li>
                }
            </ul>
        </div>

        <div class="col-md-8">
            <h4>Usuarios</h4>
            @if (users.Any())
            {
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Usuario</th>
                                <th>Email</th>
                                <th>Nombre</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var user in users)
                            {
                                <tr>
                                    <td>@user.UserName</td>
                                    <td>@user.Email</td>
                                    <td>@user.FirstName @user.LastName</td>
                                    <td>
                                        <button class="btn btn-info btn-sm" @onclick="() => SelectUser(user)">Gestionar Roles</button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <p>No hay usuarios para mostrar.</p>
            }

            @if (selectedUser != null)
            {
                <hr />
                <h5>Roles para @selectedUser.UserName</h5>
                <p>Roles actuales: @(string.Join(", ", selectedUserRoles))</p>

                <div class="input-group mb-3">
                    <select @bind="roleToAssignOrRemove" class="form-control">
                        <option value="">Seleccionar rol...</option>
                        @foreach (var role in roles)
                        {
                            <option value="@role">@role</option>
                        }
                    </select>
                    <button class="btn btn-success" @onclick="AssignRoleToUser" disabled="@(string.IsNullOrEmpty(roleToAssignOrRemove))">Asignar Rol</button>
                    <button class="btn btn-warning" @onclick="RemoveRoleFromUser" disabled="@(string.IsNullOrEmpty(roleToAssignOrRemove))">Quitar Rol</button>
                </div>
            }
        </div>
    </div>
}

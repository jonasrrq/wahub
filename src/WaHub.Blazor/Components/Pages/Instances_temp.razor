@page "/instances"
@using WaHub.Blazor.Services
@using Microsoft.AspNetCore.Components.Authorization
@inject LocalizationService Localization
@attribute [Authorize]

<PageTitle>@Localization.YourInstances - WaHub</PageTitle>

<div class="instances-container">
    <div class="instances-header">
        <h1>@Localization.YourInstances</h1>
        <button class="btn-primary" @onclick="CreateNewInstance">
            ‚ûï Nueva Instancia
        </button>
    </div>
    
    <div class="instances-grid">
        @foreach (var instance in instances)
        {
            <div class="instance-card @(instance.IsActive ? "active" : "inactive")">
                <div class="instance-header">
                    <div class="instance-status">
                        <span class="status-indicator @(instance.IsActive ? "online" : "offline")"></span>
                        <span class="status-text">@(instance.IsActive ? "Conectado" : "Desconectado")</span>
                    </div>
                    <div class="instance-actions">
                        <button class="btn-icon" @onclick="() => ToggleInstance(instance)">
                            @(instance.IsActive ? "‚è∏Ô∏è" : "‚ñ∂Ô∏è")
                        </button>
                        <button class="btn-icon" @onclick="() => DeleteInstance(instance)">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
                
                <div class="instance-info">
                    <h3>@instance.Name</h3>
                    <p class="instance-number">@instance.PhoneNumber</p>
                </div>
                
                <div class="instance-stats">
                    <div class="stat">
                        <span class="stat-value">@instance.MessagesSent</span>
                        <span class="stat-label">Mensajes</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value">@instance.Contacts</span>
                        <span class="stat-label">Contactos</span>
                    </div>
                </div>
                
                <div class="instance-footer">
                    <small>Creado: @instance.CreatedAt.ToString("dd/MM/yyyy")</small>
                    <button class="btn-secondary" @onclick="() => ManageInstance(instance)">
                        Administrar
                    </button>
                </div>
            </div>
        }
        
        @if (!instances.Any())
        {
            <div class="empty-state">
                <div class="empty-icon">üì±</div>
                <h2>No tienes instancias</h2>
                <p>Crea tu primera instancia de WhatsApp para comenzar a enviar mensajes</p>
                <button class="btn-primary" @onclick="CreateNewInstance">
                    Crear Primera Instancia
                </button>
            </div>
        }
    </div>
</div>

@code {
    private List<WhatsAppInstance> instances = new();

    protected override void OnInitialized()
    {
        // Simular datos de instancias
        instances = new List<WhatsAppInstance>
        {
            new WhatsAppInstance
            {
                Id = 1,
                Name = "Ventas Principal",
                PhoneNumber = "+34 666 123 456",
                IsActive = true,
                MessagesSent = 1234,
                Contacts = 89,
                CreatedAt = DateTime.Now.AddDays(-30)
            },
            new WhatsAppInstance
            {
                Id = 2,
                Name = "Soporte T√©cnico",
                PhoneNumber = "+34 666 789 012",
                IsActive = false,
                MessagesSent = 567,
                Contacts = 45,
                CreatedAt = DateTime.Now.AddDays(-15)
            },
            new WhatsAppInstance
            {
                Id = 3,
                Name = "Marketing",
                PhoneNumber = "+34 666 345 678",
                IsActive = true,
                MessagesSent = 2890,
                Contacts = 156,
                CreatedAt = DateTime.Now.AddDays(-7)
            }
        };
    }

    private void CreateNewInstance()
    {
        // L√≥gica para crear nueva instancia
    }

    private void ToggleInstance(WhatsAppInstance instance)
    {
        instance.IsActive = !instance.IsActive;
        StateHasChanged();
    }

    private void DeleteInstance(WhatsAppInstance instance)
    {
        instances.Remove(instance);
        StateHasChanged();
    }

    private void ManageInstance(WhatsAppInstance instance)
    {
        // Navegar a p√°gina de administraci√≥n de instancia
    }

    private class WhatsAppInstance
    {
        public int Id { get; set; }
        public string Name { get; set; } = "";
        public string PhoneNumber { get; set; } = "";
        public bool IsActive { get; set; }
        public int MessagesSent { get; set; }
        public int Contacts { get; set; }
        public DateTime CreatedAt { get; set; }
    }
}
